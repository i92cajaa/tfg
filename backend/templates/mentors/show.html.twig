{% extends 'base-admin.html.twig' %}

{% block title %}{{ ('Show ' ~ configuration.client_nomenclature)|trans }}{% endblock %}

{% block page_title %}
{{ ('Show ' ~ configuration.client_nomenclature)|trans }}
{% endblock %}

{% block body %}

    {% if userPermission.can('create', 'templates') or userPermission.can('edit', 'templates') %}
        <div class="modal fade" id="templateModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-content" id="templateModalContent" >

                </div>
            </div>
        </div>
    {% endif %}

    <div class="container-fluid">
        <!-- User Card & Plan Starts -->
        <div class="row">

            <div class="col-12">

            <ul class="nav nav-pills pl-2" role="tablist">
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center active" id="info-tab" data-bs-toggle="tab"
                       href="#info" aria-controls="account" role="tab" aria-selected="true">
                        <i data-feather="user"></i><span class="d-none d-sm-block">{{ 'Info'|trans}}</span>
                    </a>
                </li>
                <!--<li class="nav-item">
                    <a class="nav-link d-flex align-items-center" id="time-slots-tab" data-bs-toggle="tab"
                       href="#time-slots" aria-controls="time-slots" role="tab" aria-selected="false">
                        <i data-feather="watch"></i><span class="d-none d-sm-block">{{ 'Available Time Slots'|trans }}</span>
                    </a>
                </li>-->
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center" id="clinical-history-tab" data-bs-toggle="tab"
                       href="#clinical-history" aria-controls="account" role="tab" aria-selected="true">
                        <i data-feather="layout"></i><span class="d-none d-sm-block">{{ 'Clinical History'|trans }}</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link d-flex align-items-center" id="tasks-tab" data-bs-toggle="tab"
                       href="#tasks" aria-controls="information" role="tab" aria-selected="false">
                        <i data-feather="check-square"></i><span class="d-none d-sm-block">{{ 'Tasks'|trans }}</span>
                    </a>
                </li>
            </ul>
            <!-- User Card starts-->
            <div class="col-12">
                <div class="tab-content">
                    <div class="tab-pane active row" id="info" aria-labelledby="info-tab" role="tabpanel">
                        <div class="col-xl-12 col-lg-12 col-md-12">
                            <div class="card user-card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-xl-4 col-lg-12 d-flex flex-column justify-content-between border-container-lg">
                                            <div class="user-avatar-section">
                                                <div class="d-flex justify-content-start">
                                                    <!--<img
                                                            class="img-fluid rounded"
                                                            src="{% if client.imgProfile != null %}{{ documentImage.DocumentImage(client.imgProfile) }}{% else %}{{ asset('assets/assets/images/profile/default.png') }}{% endif %}"
                                                            height="104"
                                                            width="104"
                                                            alt="User avatar"
                                                    />-->
                                                    <div class="d-flex flex-column m-l-10">
                                                        <div class="user-info mb-1">
                                                            <h4 class="mb-0">{{ client.name }} {{ client.surnames }}</h4>
                                                            <span class="card-text">{{ client.email }}</span>
                                                        </div>
                                                        <div class="d-flex flex-wrap">
                                                            {% if userPermission.can('edit', 'clients') %}
                                                            <div class="mr-2">
                                                                <a href="{{ path('client_edit', {'client': client.id}) }}" class="btn btn-primary">{{ 'Edit'|trans }}</a>
                                                            </div>
                                                            {% endif %}

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            {#
                                            <div class="d-flex align-items-center user-total-numbers">
                                                <div class="d-flex align-items-center mr-2">
                                                    <div class="color-box bg-light-primary">
                                                        <i data-feather="dollar-sign" class="text-primary"></i>
                                                    </div>
                                                    <div class="ml-1">
                                                        <h5 class="mb-0">23.3k</h5>
                                                        <small>Monthly Sales</small>
                                                    </div>
                                                </div>
                                                <div class="d-flex align-items-center">
                                                    <div class="color-box bg-light-success">
                                                        <i data-feather="trending-up" class="text-success"></i>
                                                    </div>
                                                    <div class="ml-1">
                                                        <h5 class="mb-0">$99.87K</h5>
                                                        <small>Annual Profit</small>
                                                    </div>
                                                </div>
                                            </div>
                                            #}
                                        </div>
                                        <div class="col-xl-8 col-lg-12 mt-2 mt-xl-0">
                                            <div class="user-info-wrapper ">
                                                <div class="row">
                                                    <div class="d-flex flex-wrap align-items-end col-6">
                                                    <div class="user-info-title col-6">
                                                        <i data-feather="user" class="mr-1"></i>
                                                        <span class="card-text user-info-title font-weight-bold mb-0">{{ 'Full Name'|trans }}: </span>
                                                    </div>
                                                    <div class="col-6">
                                                        <p class="card-text mb-0">{{ client.name }} {{ client.surnames }}</p>
                                                    </div>
                                                </div>
                                                    <div class="d-flex flex-wrap align-items-end col-6">
                                                    <div class="user-info-title col-6">
                                                        <i data-feather="credit-card" class="mr-1"></i>
                                                        <span class="card-text user-info-title font-weight-bold mb-0">{{ 'ID'|trans }}: </span>
                                                    </div>
                                                    <div class="col-6">
                                                        <p class="card-text mb-0">{{ client.dni }}</p>
                                                    </div>
                                                </div>
                                                </div>
                                                <div class="row">
                                                    <div class="d-flex flex-wrap align-items-end col-6">
                                                    <div class="user-info-title col-6">
                                                        <i data-feather="phone-call" class="mr-1"></i>
                                                        <span class="card-text user-info-title font-weight-bold mb-0">{{ 'Phones'|trans }}: </span>
                                                    </div>
                                                    <div class="col-6">
                                                        <p class="card-text mb-0">{{ client.phone1 }} | {{ client.phone2 }}</p>
                                                    </div>
                                                </div>
                                                    <div class="d-flex flex-wrap align-items-end col-6">
                                                    <div class="user-info-title col-6">
                                                        <i data-feather="map" class="mr-1"></i>
                                                        <span class="card-text user-info-title font-weight-bold mb-0">{{ 'Address'|trans }}: </span>
                                                    </div>
                                                    <div class="col-6">
                                                        <p class="card-text mb-0">{% if client.address %}{{ client.address }}{% endif %}</p>
                                                    </div>
                                                </div>
                                                </div>
                                                <div class="row">
                                                    <div class="d-flex flex-wrap align-items-end col-6">
                                                    <div class="user-info-title col-6">
                                                        <i data-feather="check" class="mr-1"></i>
                                                        <span class="card-text user-info-title font-weight-bold mb-0">{{ 'Status'|trans }}: </span>
                                                    </div>
                                                    <div class="col-6">
                                                        <p class="card-text mb-0">{% if client.status %}{{ 'Active'|trans }}{% else %}{{ 'Inactive'|trans }}{% endif %}</p>
                                                    </div>
                                                </div>
                                                    <div class="d-flex flex-wrap align-items-end my-50 col-6">
                                                    <div class="user-info-title col-6">
                                                        <i data-feather="type" class="mr-1"></i>
                                                        <span class="card-text user-info-title font-weight-bold mb-0">{{ 'Comments'|trans }}: </span>
                                                    </div>
                                                    <div class="col-6">
                                                        <p class="card-text mb-0">{{ client.comments }}</p>
                                                    </div>
                                                </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body w-100">
                                    {% set weekDays = {1:'Monday', 2:'Tuesday', 3:'Wednesday', 4:'Thursday', 5:'Friday', 6:'Saturday', 0:'Sunday'} %}
                                    {% for timeSlot in client.getAvailableTimeSlots %}
                                        <div class="col-12 row m-b-15 p-t-10 p-b-10 border border-top-primary" id="time-slot-{{ loop.index }}">
                                            <div class="col-md-6 row">

                                                <div class="col-12 text-center m-t-10">
                                                    <b>{{ 'From'|trans }}</b>
                                                    <hr>
                                                </div>

                                                <div class="form-group col-xl-6 col-12">
                                                    <label for="">{{ 'Weekday'|trans }}</label>
                                                    <input type="text" disabled value="{{ weekDays[timeSlot['from']['weekDay']]|trans }}" class="form-control"   autocomplete="off">
                                                </div>

                                                <div class="form-group col-xl-6 col-12">
                                                    <label for="">{{ 'Hour'|trans }}</label>
                                                    <input type="text" disabled value="{{ timeSlot['from']['time'] }}" class="form-control"   autocomplete="off">
                                                </div>

                                            </div>

                                            <div class="col-md-6 row">

                                                <div class="col-12 text-center m-t-10">
                                                    <b>{{ 'To'|trans }}</b>
                                                    <hr>
                                                </div>

                                                <div class="form-group col-xl-6 col-12">
                                                    <label for="">{{ 'Weekday'|trans }}</label>
                                                    <input type="text" disabled value="{{ weekDays[timeSlot['to']['weekDay']]|trans }}" class="form-control"   autocomplete="off">
                                                </div>

                                                <div class="form-group col-xl-6 col-12">
                                                    <label for="">{{ 'Hour'|trans }}</label>
                                                    <input type="text" disabled value="{{ timeSlot['to']['time'] }}" class="form-control"   autocomplete="off">
                                                </div>

                                            </div>


                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--<div class="tab-pane row" id="time-slots" aria-labelledby="time-slots-tab" role="tabpanel">

                        <div class="col-12">
                            <div class="card">
                                <div class="card-body w-100">
                                    {% set weekDays = {1:'Monday', 2:'Tuesday', 3:'Wednesday', 4:'Thursday', 5:'Friday', 6:'Saturday', 0:'Sunday'} %}
                                    {% for timeSlot in client.getAvailableTimeSlots %}
                                        <div class="col-6 row m-b-15 p-t-10 p-b-10 border border-top-primary" id="time-slot-{{ loop.index }}">
                                            <div class="col-md-6 row">

                                                <div class="col-12 text-center m-t-10">
                                                    <b>{{ 'From'|trans }}</b>
                                                    <hr>
                                                </div>

                                                <div class="form-group col-xl-6 col-12">
                                                    <label for="">{{ 'Weekday'|trans }}</label>
                                                    <input type="text" disabled value="{{ weekDays[timeSlot['from']['weekDay']]|trans }}" class="form-control"   autocomplete="off">
                                                </div>

                                                <div class="form-group col-xl-6 col-12">
                                                    <label for="">{{ 'Hour'|trans }}</label>
                                                    <input type="text" disabled value="{{ timeSlot['from']['time'] }}" class="form-control"   autocomplete="off">
                                                </div>

                                            </div>

                                            <div class="col-md-6 row">

                                                <div class="col-12 text-center m-t-10">
                                                    <b>{{ 'To'|trans }}</b>
                                                    <hr>
                                                </div>

                                                <div class="form-group col-xl-6 col-12">
                                                    <label for="">{{ 'Weekday'|trans }}</label>
                                                    <input type="text" disabled value="{{ weekDays[timeSlot['to']['weekDay']]|trans }}" class="form-control"   autocomplete="off">
                                                </div>

                                                <div class="form-group col-xl-6 col-12">
                                                    <label for="">{{ 'Hour'|trans }}</label>
                                                    <input type="text" disabled value="{{ timeSlot['to']['time'] }}" class="form-control"   autocomplete="off">
                                                </div>

                                            </div>


                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>-->

                    <div class="tab-pane row" id="clinical-history" aria-labelledby="clinical-history-tab" role="tabpanel">
                        <div class="col-12">
                            <div class="row invoice-preview">

                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <div class="row">
                                                <div class="col-md-9 col-sm-12">
                                                    <ul class="nav nav-pills">
                                                        {% for templateType in templateTypes %}
                                                            <li class="nav-item">
                                                                <a class="nav-link {% if loop.first %}active{% endif %}" data-bs-toggle="tab"
                                                                href="#template-type-{{ templateType.id }}" aria-controls="account" role="tab" aria-selected="true">
                                                                    {{ templateType.name }}
                                                                </a>
                                                            </li>

                                                        {% endfor %}

                                                    </ul>
                                                </div>
                                                    <div class="col-md-3 col-sm-12 text-end">
                                                {% if userPermission.can('export', 'templates') %}
                                                    <button class="btn add-new btn-secondary mr-1" type="button" onclick="exportTemplates()"><span class="text-white">{{ 'Export'|trans }}</span></button>
                                                {% endif %}
                                                {% if userPermission.can('create', 'templates') %}
                                                    <a><button class="btn add-new btn-primary" type="button" onclick="openCreateModal()"><span class="text-white">{{ 'Create Template'|trans }}</span></button></a>
                                                {% endif %}
                                            </div>
                                                </div>
                                            </div>
                                        <div class="tab-content">
                                            {% for templateType in templateTypes %}
                                                <div class="tab-pane fade {% if loop.first %}show active {% endif %}" id="template-type-{{ templateType.id }}" role="tabpanel" aria-labelledby="home-tab">
                                                    <div class="table-responsive overflow-inherit">

                                                        <table class="table table-striped table-borderless">
                                                            <thead class="thead-light">
                                                            <tr>
                                                                <th class="text-truncate">
                                                                    <a>
                                                                        {{ 'Date'|trans }}
                                                                    </a>
                                                                </th>
                                                                {% for templateTypeLine in templateType.templateLineTypes %}
                                                                    <th>
                                                                        <a>
                                                                            {{ templateTypeLine.name }}
                                                                        </a>
                                                                    </th>
                                                                {% endfor %}

                                                                <th>
                                                                    <a>
                                                                        {{ 'Actions'|trans }}
                                                                    </a>
                                                                </th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>
                                                            {% for template in client.getTemplatesByTemplateType(templateType) %}
                                                                <tr>
                                                                    <td>
                                                                        {{ template.createdAt ? template.createdAt|UTCDateTimeFormat('d-m-Y H:i') : '' }}
                                                                    </td>
                                                                    {% for templateTypeLine in templateType.templateLineTypes %}
                                                                        <td>
                                                                            <a>

                                                                                {% include 'template/render_template_value.html.twig' with {'templateLine': template.getTemplateLineByName(templateTypeLine.name)} only %}

                                                                            </a>
                                                                        </td>
                                                                    {% endfor %}

                                                                    <td>
                                                                        <div class="btn-group">
                                                                            <button class="btn dropdown-toggle waves-effect waves-float waves-light p-0" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                <i data-feather='align-justify' class="font-medium-5"></i>
                                                                            </button>
                                                                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" data-boundary="window" style="z-index: 999 !important;">

                                                                                {% if userPermission.can('edit', 'templates') %}
                                                                                    <a class="dropdown-item" onclick="openEditModal('{{ template.id }}')" data-id="{{ template.id }}"><i data-feather='edit'></i> {{ 'Edit'|trans }}</a>
                                                                                {% endif %}

                                                                                {% if userPermission.can('delete', 'templates') %}
                                                                                    <div class="dropdown-divider"></div>
                                                                                    <a class="dropdown-item" onclick="$('#deleteForm_template_{{ template.id }}').submit()"><i data-feather='delete'></i> {{ 'Delete'|trans }}</a>
                                                                                    <form method="post" id="deleteForm_template_{{ template.id }}" action="{{ path('template_delete', {'template': template.id}) }}" class="deleteForm d-none">
                                                                                        <input type="hidden" name="_method" value="DELETE">
                                                                                        <input type="hidden" name="_token" value="{{ csrf_token('delete') }}">
                                                                                        <input type="hidden" name="route" value="{{ path('client_show', {'client': template.client.id}) }}">
                                                                                    </form>
                                                                                {% endif %}
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}

                                                            </tbody>
                                                        </table>

                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>

                                </div>
                                {% if userPermission.can('list', 'appointments') %}
                                    <div class="col-md-12">

                                        <div class="card">
                                            <div class="card-header">
                                                <div class="col-6">
                                                    <h5 class="">{{ 'Appointments'|trans }}</h5>
                                                </div>
                                                <div class="col d-flex align-items-center flex-row-reverse">
                                                    {% if userPermission.can('create', 'appointments') %}
                                                        <a href="{{ path('appointment_new') }}"><button class="btn add-new btn-primary" type="button" id="addAppointment" data-bs-toggle="modal" data-target="#appointmentModal"><span class="text-white">{{ 'Create Appointment'|trans }}</span></button></a>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div class="card-datatable table-responsive">
                                                    <table class="invoice-list-table table">
                                                        <thead>
                                                        <tr>
                                                            <th>
                                                                <a href="{{ filterService.orderBy("user", filterService.getInversedOrder("user")) }}">
                                                                    {{ configuration.user_nomenclature|trans }} {% if filterService.isOrdered("user") %}<i data-feather="{{ filterService.getOrder("user").order == 'asc' ? 'arrow-up' : 'arrow-down' }}"></i>{% endif %}
                                                                </a>
                                                            </th>
                                                            <th class="text-truncate">
                                                                <a href="{{ filterService.orderBy("time_from", filterService.getInversedOrder("time_from")) }}">
                                                                    {{ 'Start'|trans }} {% if filterService.isOrdered("time_from") %}<i data-feather="{{ filterService.getOrder("time_from").order == 'asc' ? 'arrow-up' : 'arrow-down' }}"></i>{% endif %}
                                                                </a>
                                                            </th>
                                                            <th class="text-truncate">
                                                                <a href="{{ filterService.orderBy("time_to", filterService.getInversedOrder("time_to")) }}">
                                                                    {{ 'End'|trans }} {% if filterService.isOrdered("time_to") %}<i data-feather="{{ filterService.getOrder("time_to").order == 'asc' ? 'arrow-up' : 'arrow-down' }}"></i>{% endif %}
                                                                </a>
                                                            </th>
                                                            <th>
                                                                <a href="{{ filterService.orderBy("status", filterService.getInversedOrder("status")) }}">
                                                                    {{ 'Status'|trans }} {% if filterService.isOrdered("status") %}<i data-feather="{{ filterService.getOrder("status").order == 'asc' ? 'arrow-up' : 'arrow-down' }}"></i>{% endif %}
                                                                </a>
                                                            </th>
                                                            <th>
                                                                <a>
                                                                    {{ 'Actions'|trans }}
                                                                </a>
                                                            </th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        {% for appointment in appointments['data'] %}
                                                            <tr data-id="{{ appointment.id }}">
                                                                <td>{{ appointment.user.name }} {{ appointment.user.surnames }}</td>
                                                                <td>{{ appointment.timeFrom ? appointment.timeFrom|UTCDateTimeFormat('d-m-Y H:i') : '' }}</td>
                                                                <td>{{ appointment.timeTo ? appointment.timeTo|UTCDateTimeFormat('d-m-Y H:i') : '' }}</td>
                                                                <td>{% if appointment.status %}Activa{% else %}Liberada{% endif %}</td>
                                                                <td>
                                                                    <div class="btn-group">
                                                                        <button class="btn dropdown-toggle waves-effect waves-float waves-light p-0" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                            <i data-feather='align-justify' class="font-medium-5"></i>
                                                                        </button>
                                                                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" data-boundary="window" style="z-index: 999 !important;">
                                                                            {% if userPermission.can('show', 'appointments') %}
                                                                                <a class="dropdown-item" href="{{ path('appointment_show', {'appointment':appointment.id}) }}" data-id="{{ appointment.id }}"><i data-feather='eye'></i> {{ 'Show'|trans }}</a>
                                                                            {% endif %}
                                                                            {% if userPermission.can('edit', 'appointments') %}
                                                                                <a class="dropdown-item" href="{{ path('appointment_edit', {'appointment': appointment.id}) }}"><i data-feather='edit'></i> {{ 'Edit'|trans }}</a>

                                                                            {% endif %}
                                                                            {% if userPermission.can('delete', 'appointments') %}
                                                                                <div class="dropdown-divider"></div>
                                                                                <a class="dropdown-item" onclick="$('#deleteForm_appointment_{{ appointment.id }}').submit()"><i data-feather='delete'></i> {{ 'Delete'|trans }}</a>
                                                                                <form method="post" id="deleteForm_appointment_{{ appointment.id }}" action="{{ path('appointment_delete', {'appointment': appointment.id}) }}" class="deleteForm d-none">
                                                                                    <input type="hidden" name="_method" value="DELETE">
                                                                                    <input type="hidden" name="_token" value="{{ csrf_token('delete') }}">
                                                                                    <input type="hidden" name="route" value="{{ path('client_show', {'client': client.id}) }}">
                                                                                </form>
                                                                            {% endif %}
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        {% else %}
                                                            <tr>
                                                                <td colspan="6">{{ 'No results found'|trans }}</td>
                                                            </tr>
                                                        {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    <div class="d-flex justify-content-end m-2">
                                                        {% if userPermission.can('list', 'appointments') %}
                                                            <a href="{{ path('appointment_list', {'client_id': client.id}) }}"><button class="btn add-new btn-primary" type="button" ><span class="text-white">{{ 'See More'|trans }}</span></button></a>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                {% endif %}
                            </div>
                        </div>

                    </div>

                    <div class="tab-pane row" id="tasks" aria-labelledby="tasks-tab" role="tabpanel">
                        <div class="col-12 row" id="task-schema">

                            {% include 'task/schema.html.twig' with {'entity' : client, 'entityType': 'client'} %}

                        </div>

                    </div>
                </div>
            </div>
        </div>
        <!-- /User Invoice Ends-->
    </div>
</div>
{% endblock %}

{% block javascripts %}

    <script>

        function instanceDragDrop(){
            $( ".task-draggable" ).draggable({
                revert: "invalid",
                zIndex: 999,
                connectToSortable: ".task-draggable-div"
            })

            $( ".task-draggable-div" ).droppable({
                accept: ".task-draggable",
                drop: function (e, ui) {

                    ui.draggable.css('left', 0);
                    ui.draggable.css('top', 0);

                    $(this).append(ui.draggable)

                    $.ajax({
                        url: '{{ path('task_change_status') }}',
                        type: 'post',
                        dataType: 'json',
                        delay: 250,
                        data: {
                            _token: '{{ csrf_token('change-status-task') }}',
                            id: ui.draggable.data('task-id'), // search term
                            status: $(this).data('task-status')
                        },
                        success: function (response) {
                            Swal.fire(
                                '{{ 'Task Updated'|trans }}',
                                '{{ 'Task Status Updated Successfully'|trans }}',
                                'success'
                            )

                            $.ajax({
                                url: '{{ path('task_schema_get') }}',
                                type: 'post',
                                dataType: 'json',
                                delay: 250,
                                data: {
                                    _token: '{{ csrf_token('get-task-schema-template') }}',
                                    appointment: null,
                                    client: '{{ client.id }}'
                                },
                                success: function (response) {
                                    if(response.success){

                                        $('#task-schema').html(response.data);

                                        if (feather) {
                                            feather.replace({
                                                width: 14,
                                                height: 14
                                            });
                                        }

                                        instanceDragDrop()

                                    }
                                },
                                error: function(jqXHR, textStatus, errorThrown) {
                                    console.log(textStatus, errorThrown);
                                }
                            })

                        }
                    })

                }
            });
        }

        $(function(){
            instanceDragDrop()

        });

        {% if userPermission.can('export', 'templates') %}
        async function exportTemplates()
        {

            const { value: formValues } = await Swal.fire({
                title: '{{ 'Export'|trans }} {{ 'Templates'|trans }}',
                html: '{{ 'Select The Templates To Be Exported'|trans }}.' +
                    '<div class="form-group">' +
                    '<label class="form-control-label" for="swal-input-select">{{ 'Templates'|trans }}</label>' +
                    '<select class="form-control" id="swal-input-select" multiple name="type[]">' +
                        {% for templateType in templateTypes %}
                    '<option value="{{ templateType.id }}">{{ templateType.name }}</option>' +
                        {% endfor %}
                    '</select>' +
                    '</div>' +
                    '<div class="form-group">' +
                    '<label class="form-control-label" for="swal-input-date">{{ 'Dates'|trans }}</label>' +
                    '<input type="text" class="form-control" id="swal-input-date">' +
                    '</div>'
                ,
                showCancelButton: true,
                confirmButtonText: 'Siguiente',
                cancelButtonText: 'Cancelar',
                showLoaderOnConfirm: true,
                allowOutsideClick: () => !Swal.isLoading(),
                didOpen: function () {
                    $('#swal-input-select').select2({});

                    flatpickr('#swal-input-date',{
                        locale: locale,
                        mode: "range",
                        dateFormat: "d-m-Y",
                    })
                },
                preConfirm: () => {

                    return {
                        'types': $('#swal-input-select').val(),
                        'dateRange': $('#swal-input-date').val()
                    };
                }
            })

            if(formValues) {

                let form = document.createElement('form');

                form.setAttribute('method', "post");
                form.setAttribute('action', "{{ path('export_template_pdf') }}");


                let clientInput = document.createElement('input')
                clientInput.type = 'hidden';
                clientInput.name = 'client';
                clientInput.value = '{{ client.id }}';

                let dateRangeInput = document.createElement('input')
                dateRangeInput.type = 'hidden';
                dateRangeInput.name = 'date_range';
                dateRangeInput.value = formValues.dateRange;

                for( let i = 0; i < formValues.types.length; i++ ) {
                    let typesInput = document.createElement('input')
                    typesInput.type = 'hidden';
                    typesInput.name = `types[]`;
                    typesInput.value = formValues.types[i];

                    form.appendChild(typesInput);
                }


                form.appendChild(clientInput);
                form.appendChild(dateRangeInput);



                document.body.appendChild(form);

                form.submit();

            }

        }
        {% endif %}

        {% if userPermission.can('create', 'templates') %}
        async function openCreateModal()
        {

            const { value: templateType } = await Swal.fire({
                title: '{{ 'Create Template'|trans }}',
                html: '{{ 'Select The Template You Want To Create'|trans }}.' +
                    '<select class="form-control" id="swal-input-select">' +
                        {% for templateType in templateTypes %}
                    '   <option value="{{ templateType.id }}">{{ templateType.name }}</option>' +
                        {% endfor %}
                    '</select>',
                showCancelButton: true,
                confirmButtonText: 'Siguiente',
                cancelButtonText: 'Cancelar',
                showLoaderOnConfirm: true,
                allowOutsideClick: () => !Swal.isLoading(),
                didOpen: function () {
                    $('#swal-input-select').select2({});
                },
                preConfirm: () => {
                    return $('#swal-input-select').val();
                }
            })

            if(templateType) {

                $.ajax({
                    url: '{{ path('template_get_create_template') }}',
                    type: 'post',
                    dataType: 'json',
                    delay: 250,
                    data: {
                        _token: '{{ csrf_token('get-create-template-template') }}',
                        templateType: templateType,
                        client: '{{ client.id }}',
                    },
                    success: function (response) {
                        if (response.success) {

                            $('#templateModalContent').html(response.data);

                            if (feather) {
                                feather.replace({
                                    width: 14,
                                    height: 14
                                });
                            }

                            $('#templateModal').modal('show');
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: response.message,
                                showConfirmButton: false,
                                timer: 2000
                            })
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log(textStatus, errorThrown);
                    }
                })
            }

        }
        {% endif %}

        {% if userPermission.can('edit', 'templates') %}
        function openEditModal(id){

            $.ajax({
                url: '{{ path('template_get_edit_template') }}',
                type: 'post',
                dataType: 'json',
                delay: 250,
                data: {
                    _token: '{{ csrf_token('get-edit-template-template') }}',
                    template: id, // search term
                },
                success: function (response) {
                    if(response.success){

                        $('#templateModalContent').html(response.data);

                        if (feather) {
                            feather.replace({
                                width: 14,
                                height: 14
                            });
                        }

                        $('#templateModal').modal();

                    }else{
                        Swal.fire({
                            icon: 'error',
                            title: response.message,
                            showConfirmButton: false,
                            timer: 2000
                        })
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.log(textStatus, errorThrown);
                }
            })

        }
        {% endif %}


    </script>
{% endblock %}


{% block action_buttons %}
    <li class="level-menu outside">

        <a class="nav-link cursor-pointer" href="{{ userPermission.can('list', 'clients') ? path('client_index') : '#' }}"  >
            <i class="ficon" data-feather="chevron-left"></i>
        </a>
    </li>

{% endblock %}