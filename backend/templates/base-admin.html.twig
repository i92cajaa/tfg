<!DOCTYPE html>
<html lang="{{ _locale|lower }}">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{{ configuration.favicon ? path('document_render', {'document':  configuration.favicon})}}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ configuration.favicon ? path('document_render', {'document':  configuration.favicon})}}" type="image/x-icon">
    <title>{% block title %}{% endblock %} - {{ configuration.app_name }}</title>
    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Rubik:400,400i,500,500i,700,700i&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/font-awesome.css') }}">
    <!-- ico-font-->
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/vendors/icofont.css') }}">
    <!-- Themify icon-->
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/vendors/themify.css') }}">
    <!-- Flag icon-->
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/vendors/flag-icon.css') }}">
    <!-- Feather icon-->
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/vendors/feather-icon.css') }}">
    <!-- Plugins css start-->
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/vendors/scrollbar.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/vendors/prism.css') }}">
    <!-- Plugins css Ends-->
    <!-- Bootstrap css-->
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/vendors/bootstrap.css') }}">

    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/vendors/select2.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/vendors/sweetalert2.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/vendors/intltelinput.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset("assets/css/vendors/flatpickr/flatpickr.min.css") }}">
    <link rel="stylesheet" type="text/css" href="{{ asset("assets/css/vendors/jquery-ui/jquery-ui.min.css") }}">
    <!-- App css-->
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/style.css') }}">

    <!-- Responsive css-->
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/responsive.css') }}">

    <link rel="stylesheet" type="text/css" href="{{ asset("assets/css/vendors/quill/quill.snow.css") }}">

    <link rel="stylesheet" type="text/css" href="{{ asset('assets/css/custom.css') }}">

    <style>
        :root{
            {% if configuration.primary_color is not null %}
                --primary: {{ configuration.primary_color }} !important;
                --theme-deafult: var(--primary);
                --bs-primary: var(--primary);
            {% endif %}
            {% if configuration.secondary_color is not null %}
                --secondary: {{ configuration.secondary_color }} !important;
                --theme-secondary: var(--secondary);
                --bs-secondary: var(--secondary);
            {% endif %}

        }
    </style>

    {% block stylesheets %}
    {% endblock %}

</head>
<body>

    <div class="modal fade" id="taskModal" tabindex="-1" role="dialog" aria-labelledby="taskModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content" id="taskModalContent">

            </div>
        </div>
    </div>
<!-- loader ends-->
<!-- tap on top starts-->
<div class="tap-top"><i data-feather="chevrons-up"></i></div>
<!-- tap on tap ends-->
<!-- page-wrapper Start-->
<div class="page-wrapper compact-wrapper" id="pageWrapper">
    <!-- Page Header Start-->
    <div class="page-header {% if not app.user.menuExpanded %} close_icon {% endif %}">
        <div class="header-wrapper row m-0">

            <div class="header-logo-wrapper col-auto p-0">
                <div class="logo-wrapper">
                    <a href="#">
                        <img class="img-fluid"  src="{{ configuration.logo_small ? path('document_render', {'document':  configuration.logo_small}) : asset('assets/images/logo/logo.png') }}" alt="">
                    </a>
                </div>
                <div class="toggle-sidebar" onclick="toggleMenu()"><i class="status_toggle middle sidebar-toggle" data-feather="align-center"></i></div>
            </div>
            <div class="left-header col horizontal-wrapper ps-0">
                <ul class="horizontal-menu">
                    {% block action_buttons %}

                    {% endblock %}
                </ul>
            </div>
            <div class="nav-right col pull-right right-header p-0">
                <ul class="nav-menus">
                    <li ><a href="{{ path('app_logout') }}" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Cerrar Sesión"><i data-feather="log-out" class="me-2" > </i><span></span></a></li>

                    <li class="profile-nav onhover-dropdown p-0 me-0" style="cursor: pointer !important;" >
                        <a href="{{ path('user_view_profile', {'user': app.user.id}) }}"  data-bs-toggle="tooltip" data-bs-placement="bottom" title="Ver Perfil">
                            <div class="media profile-media"><img class="b-r-10 avatar-img" src="{% if app.user.imgProfile != null %}{{ documentImage.DocumentImage(app.user.imgProfile) }}{% else %}{{ asset('assets/images/dashboard/profile.jpg') }}{% endif %}" alt="">
                                <div class="media-body"><span>{{ app.user.fullName }}</span>
                                    <p class="mb-0 font-roboto">{% for role in app.user.roles %}{{ role|trans }}{% endfor %}</p>
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- Page Header Ends   -->
    <!-- Page Body Start-->
    <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        <div class="sidebar-wrapper {% if not app.user.menuExpanded %} close_icon {% endif %}">
            <div>
                <div class="logo-wrapper"><a href="#"><img class="img-fluid for-light" style="height: 50px !important;" src="{{ configuration.logo_big ? path('document_render', {'document':  configuration.logo_big}) : asset('assets/images/logo/logo.png') }}" alt=""><img class="img-fluid for-dark" style="height: 50px !important;" src="{{ configuration.logo_big ? path('document_render', {'document':  configuration.logo_big}) : asset('assets/images/logo/logo.png') }}" alt=""></a>
                    <div class="back-btn"><i class="fa fa-angle-left"></i></div>
                    <div class="toggle-sidebar" style="right: 15px; top:15px;" onclick="toggleMenu()"><i class="status_toggle middle sidebar-toggle" data-feather="grid"> </i></div>
                </div>
                <div class="logo-icon-wrapper"><a href="#"><img class="img-fluid" width="40" src="{{ configuration.logo_small ? path('document_render', {'document':  configuration.logo_small}) : asset('assets/images/logo/logo-icon.png') }}" alt=""></a></div>
                <nav class="sidebar-main">
                    <div class="left-arrow" id="left-arrow"><i data-feather="arrow-left"></i></div>
                    <div id="sidebar-menu">
                        <ul class="sidebar-links" id="simple-bar">
                            <li class="back-btn"><a><img class="img-fluid" width="40" src="{{ configuration.logo_small ? path('document_render', {'document':  configuration.logo_small}) : asset('assets/images/logo/logo-icon.png') }}" alt=""></a>
                                <div class="mobile-back text-end"><span>Back</span><i class="fa fa-angle-right ps-2" aria-hidden="true"></i></div>
                            </li>

                            <li class="sidebar-list">
                                <a href="{{ path('schedule_index') }}" class="sidebar-link sidebar-title link-nav {% if app.request.attributes.get( '_route' ) == 'schedule_index' %}nav-active{% endif %}" data-original-title="" title="">
                                    <i data-feather="calendar"></i>
                                    <span>{{ 'Calendar'|trans }}</span>
                                </a>
                            </li>

                            {% if userPermission.can('list', 'bookings') %}
                                <li class="sidebar-list">
                                    <a href="{{ path('booking_index') }}" class="sidebar-link sidebar-title link-nav {% if app.request.attributes.get( '_route' ) starts with 'booking_' %}nav-active{% endif %}" data-original-title="" title="Reservas">
                                        <i data-feather="bookmark"></i>
                                        <span>Reservas</span>
                                    </a>
                                </li>
                            {% endif %}

                            {% if userPermission.can('list', 'lessons') %}
                                <li class="sidebar-list">
                                    <a href="{{ path('lesson_index') }}" class="sidebar-link sidebar-title link-nav {% if app.request.attributes.get( '_route' ) starts with 'lesson_' %}nav-active{% endif %}" data-original-title="" title="Clases">
                                        <i data-feather="book-open"></i>
                                        <span>Clases</span>
                                    </a>
                                </li>
                            {% endif %}

                            {% if userPermission.can('list', 'rooms') %}
                                <li class="sidebar-list">
                                    <a href="{{ path('room_index') }}" class="sidebar-link sidebar-title link-nav {% if app.request.attributes.get( '_route' ) starts with 'room_' %}nav-active{% endif %}" data-original-title="" title="Habitaciones">
                                        <i data-feather="home"></i>
                                        <span>Habitaciones</span>
                                    </a>
                                </li>
                            {% endif %}

                            {% if userPermission.can('list', 'centers') %}
                                <li class="sidebar-list">
                                    <a href="{{ path('center_index') }}" class="sidebar-link sidebar-title link-nav {% if app.request.attributes.get( '_route' ) starts with 'center_' %}nav-active{% endif %}" data-original-title="" title="">
                                        <i data-feather="map-pin"></i>
                                        <span>Centros</span>
                                    </a>
                                </li>
                            {% elseif app.user.isAdmin %}
                                <li class="sidebar-list">
                                    <a href="{{ path('center_show', {'center': app.user.center.id}) }}" class="sidebar-link sidebar-title link-nav {% if app.request.attributes.get( '_route' ) starts with 'center_' %}nav-active{% endif %}" data-original-title="" title="">
                                        <i data-feather="map-pin"></i>
                                        <span>Mi Centro</span>
                                    </a>
                                </li>
                            {% endif %}

                            {% if userPermission.can('list', 'areas') %}
                                <li class="sidebar-list">
                                    <a href="{{ path('area_index') }}" class="sidebar-link sidebar-title link-nav {% if app.request.attributes.get( '_route' ) starts with 'area_' %}nav-active{% endif %}" data-original-title="" title="">
                                        <i data-feather="map"></i>
                                        <span>Áreas</span>
                                    </a>
                                </li>
                            {% endif %}

                            {% if app.user.isAdmin %}
                                <li class="sidebar-main-title">
                                    <div>
                                        <h6 >{{ 'Administration'|trans }}</h6>
                                        <p>{{ 'Dashboards & configuration'|trans }}</p>
                                    </div>
                                </li>

                                {% if userPermission.can('list', 'users') %}
                                    <li class="sidebar-list">
                                        <a href="{{ path('user_index') }}" class="sidebar-link sidebar-title link-nav {% if app.request.attributes.get( '_route' ) starts with 'user_' %}nav-active{% endif %}" data-original-title="" title="">
                                            <i data-feather="user"></i>
                                            <span>{{ 'Users'|trans }}</span>
                                        </a>
                                    </li>
                                {% endif %}

                                {% if userPermission.can('list', 'clients') %}
                                    <li class="sidebar-list">
                                        <a href="{{ path('client_index') }}" class="sidebar-link sidebar-title link-nav {% if app.request.attributes.get( '_route' ) starts with 'client_' %}nav-active{% endif %}" data-original-title="" title="">
                                            <i data-feather="user"></i>
                                            <span>{{ 'Clients'|trans }}</span>
                                        </a>
                                    </li>
                                {% endif %}

                                {% if userPermission.can('edit', 'configs') %}
                                    <li class="sidebar-list">
                                        <a href="{{ path('config_edit') }}" class="sidebar-link sidebar-title link-nav {% if app.request.attributes.get( '_route' ) starts with 'config_' %}nav-active{% endif %}" data-original-title="" title="">
                                            <i data-feather="settings"></i>
                                            <span>{{ 'Configuration'|trans }}</span>
                                        </a>
                                    </li>
                                {% endif %}
                            {% endif %}

                        </ul>
                    </div>
                    <div class="right-arrow" id="right-arrow"><i data-feather="arrow-right"></i></div>
                </nav>
            </div>
        </div>
        <!-- Page Sidebar Ends-->
        <div class="page-body pt-4">
            {% block body %}{% endblock %}
        </div>
        <!-- footer start-->
        <footer class="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 footer-copyright text-center">
                        <p class="mb-0"> {{ configuration.app_name }}  </p>
                    </div>
                </div>
            </div>
        </footer>

        <div id="filterSidebar" class="sidebar mw-100">
            <div class=" w-100 p-3">
                <div class="d-flex justify-content-around align-items-around mx-50 row">
                    <div class="col-10">
                        <h3> {{ 'Filters'|trans }} </h3>
                    </div>
                    <div class="col-2">
                        <a class="nav-link pr-0" onclick="toggleFilter()" data-bs-toggle="collapse">
                            <i class="d-block font-medium-4" data-feather="x"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="shadow-bottom"></div>
            <div class="w-100 p-3 row">
                {% block sidebar %}{% endblock %}
            </div>
        </div>
    </div>
</div>
<!-- latest jquery-->
<script src="{{ asset('assets/js/jquery-3.5.1.min.js') }}"></script>
<!-- Bootstrap js-->
<script src="{{ asset('assets/js/bootstrap/bootstrap.bundle.min.js') }}"></script>
<!-- feather icon js-->
<script src="{{ asset('assets/js/icons/feather-icon/feather.min.js') }}"></script>
<script src="{{ asset('assets/js/icons/feather-icon/feather-icon.js') }}"></script>
<!-- scrollbar js-->
<script src="{{ asset('assets/js/scrollbar/simplebar.js') }}"></script>
<script src="{{ asset('assets/js/scrollbar/custom.js') }}"></script>
<!-- Sidebar jquery-->
<script src="{{ asset('assets/js/config.js') }}"></script>
<!-- Plugins JS start-->
<script src="{{ asset('assets/js/sidebar-menu.js') }}"></script>
<script src="{{ asset('assets/js/prism/prism.min.js') }}"></script>
<script src="{{ asset('assets/js/clipboard/clipboard.min.js') }}"></script>
<script src="{{ asset('assets/js/custom-card/custom-card.js') }}"></script>
<script src="{{ asset('assets/js/select2/select2.full.min.js') }}"></script>
{#<script src="{{ asset('assets/js/select2/telephone-input.js') }}"></script>#}
{#<script src="{{ asset('assets/js/form-wizard/form-wizard.js') }}"></script>#}
<script src="{{ asset('assets/js/sweet-alert/sweetalert2.all.min.js') }}"></script>
<script src="{{ asset("assets/js/flatpickr/flatpickr.min.js") }}"></script>
<script src="{{ asset("assets/js/flatpickr/es.js") }}"></script>
<script src="{{ asset("assets/js/quill/quill.js") }}"></script>
<script src="{{ asset("assets/js/quill/image-resize.min.js") }}"></script>
<script src="{{ asset("assets/js/jquery-ui/jquery-ui.min.js") }}"></script>
<script src="{{ asset("assets/js/notify/bootstrap-notify.min.js") }}"></script>
<script src="{{ asset('assets/js/select2/intltelinput.min.js') }}"></script>
<!-- Plugins JS Ends-->
<!-- Theme js-->
<script src="{{ asset('assets/js/script.js') }}"></script>
<script src="{{ asset('assets/js/custom-script.js') }}"></script>
<!-- login js-->

<!-- Plugin used-->
<script>

    let primaryColor = '{{ configuration.primary_color ?: '' }}';
    let locale = '{{ _locale|lower }}';

    $(function(){

        flatpickr(".flatpickr", {
            dateFormat: "d/m/Y",
            locale: "es",
            minDate: "today"
        });

        flatpickr(".filterpickr", {
            dateFormat: "d/m/Y",
            locale: "es"
        });

        flatpickr(".timepickr", {
            dateFormat: "H:i",
            enableTime: true,
            noCalendar: true,
            locale: "es",
        });

        let tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })

        {% for flash_message in app.session.flashbag.get('success') %}

            customNotify("{{ 'Action Done'|trans }}", "{{ flash_message }}", "success")

        {% endfor %}

        {% for flash_message in app.session.flashbag.get('error') %}

            {% if flash_message is iterable %}
                {% for m in flash_message%}
                    customNotify("{{ 'Error'|trans }}", "{{ m  }}", "error")
                {% endfor %}
            {% else %}
                customNotify("{{ 'Error'|trans }}", "{{ flash_message  }}", "error")
            {% endif %}

        {% endfor %}

        {% for flash_message in app.session.flashbag.get('notice') %}

            {% if flash_message is iterable %}
                {% for m in flash_message%}
                    customNotify("{{ 'Info'|trans }}", "{{ m  }}", "info")
                {% endfor %}
            {% else %}
                customNotify("{{ 'Info'|trans }}", "{{ flash_message  }}", "info")
            {% endif %}

        {% endfor %}


    });

    $(window).on('load', function() {
        if (feather) {
            feather.replace({
                width: 14,
                height: 14
            });
        }

        $('#toggleMenu').on('click', function () {
            toggleMenu();
        });

        if (!getCookie('timezone')) {
            document.cookie = 'timezone='+ Intl.DateTimeFormat().resolvedOptions().timeZone +'; Path=/; Expires=Thu, 01 Jan 2999 00:00:01 GMT; SameSite=Lax';
        }

        $('.deleteForm').on('submit', function(event){
            event.preventDefault();
            confirmDelete($(this));
        })

    });

    function getCookie(cookieName) {
        let cookie = [];
        document.cookie.split(';').forEach(function(el) {
            let [key,value] = el.split('=');
            cookie[key.trim()] = value;
        })
        return cookie[cookieName] ? cookie[cookieName] : null;
    }

    async function changeTimezone(){
        const { value: timezone } = await Swal.fire({
            title: '{{ 'Change Timezone'|trans }}',
            html:
                '<div class="form-group">' +
                '<select class="form-control" id="swal-input-select">' +
                    {% for timezone in _timezones %}
                '<option value="{{ timezone }}" {% if app.request.cookies.get('timezone') == timezone %}selected{% endif %}>{{ timezone }}</option>' +
                    {% endfor %}
                '</select>' +
                '</div>'
            ,
            showCancelButton: true,
            confirmButtonText: '{{ 'Continue'|trans }}',
            cancelButtonText: '{{ 'Cancel'|trans }}',
            showLoaderOnConfirm: true,
            didOpen: function () {
                $('#swal-input-select').select2({});
            },
            preConfirm: () => {
                return $('#swal-input-select').val();
            }
        })

        if (timezone) {
            document.cookie = 'timezone='+ timezone +'; Path=/; Expires=Thu, 01 Jan 2999 00:00:01 GMT; SameSite=Lax';
            location.reload();
        }
    }

    function toggleFilter(){

        if(document.getElementById("filterSidebar").style.width == '0px' || document.getElementById("filterSidebar").style.width == ''){
            openNav();
        }else{
            closeNav();
        }
    }

    function openNav() {
        document.getElementById("filterSidebar").style.width = "400px";

    }

    /* Set the width of the sidebar to 0 and the left margin of the page content to 0 */
    function closeNav() {
        document.getElementById("filterSidebar").style.width = "0px";
    }

    function toggleMenu() {
        $.ajax({
            type: 'get',
            cache: "true",
            dataType: 'json',
            url: "{{ path('toggle_menu') }}",
            data: {},
            success: function (data) {


            }
        });
    }

    function deleteNotification(notificationId){

        $.ajax({
            type: 'POST',
            url: "{{path('notification_delete')}}",
            dataType: 'json',
            data: { id: notificationId },
            success: function (response) {
                let notificationElement = document.getElementById("notification-" + notificationId);
                notificationElement.remove();
                $('.notification-counter').text($('#notificationsDiv .notification-item').length);
                let tooltipElement = document.querySelector('[role="tooltip"]');
                tooltipElement.remove();
            },
            error: function (err) {
                console.log("ERROR");
            }
        });

    }

    function deleteAllNotification(userId){

        $.ajax({
            type: 'POST',
            url: "{{path('notification_all_delete')}}",
            dataType: 'json',
            data: { userId: userId },
            success: function (response) {
                let notificationElement = document.getElementById("notification-" + notificationId);
                notificationElement.remove();
                $('.notification-counter').text($('#notificationsDiv .notification-item').length);

            },
            error: function (err) {
                console.log("ERROR");
            }
        });

    }

    function confirmDelete(form){
        Swal.fire({
            title: '{{ 'Are You Sure?'|trans }}',
            text: "{{ 'This Element Will Be Deleted'|trans }}.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: primaryColor,
            cancelButtonColor: '#d33',
            confirmButtonText: '{{ 'Delete'|trans }}',
            cancelButtonText: '{{ 'Cancel'|trans }}'
        }).then((result) => {
            if (result.isConfirmed === true) {

                form.off('submit').submit();
            }
        });
    }

</script>
<script>
    const filterSidebar = document.getElementById('filterSidebar');

    document.addEventListener('click', function(event) {
        const isClickedInsideFilterSidebar = filterSidebar.contains(event.target);

        const coincidence = ['select2', 'light'].some(str => event.target.classList.toString().includes(str));

        if (!isClickedInsideFilterSidebar && !coincidence) {
            filterSidebar.style.width = '0px';
        }
    });
</script>
    <script>
        // Obtener la pestaña activa y almacenarla en una cookie
        $(document).ready(function() {
            $('.nav-link').click(function() {
                var tabId = this.id;
                setCookie("lastTab", tabId, 30);
                //document.cookie = "lastTab=" + tabId;
                //console.log(getCookie("lastTab"));
            });

            // Seleccionar la última pestaña activa al cargar la página
            var lastTab = getCookie("lastTab");
            if (lastTab) {
                $('#' + lastTab).tab('show');
            }
        });

        function setCookie(name, value, days) {
            var expires = "";
            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            //console.log(name + "=" + value + expires + "; path=/");
            document.cookie = name + "=" + value + expires + "; path=/";
        }

        function getCookie(name) {
            var nameEQ = name + "=";
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                if (cookie.indexOf(nameEQ) == 0) {
                    return cookie.substring(nameEQ.length, cookie.length);
                }
            }
            return null;
        }
    </script>
{% block javascripts %}
{% endblock %}
</body>
</html>